<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AiMA C12 â€” ê²°ê³¼ì§€ ìƒì„±</title>
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --navy: #1B1F3B; --blue: #4A90D9; --purple: #8B6FC0;
  --lg: #F5F6FA; --mg: #E0E3EB; --dg: #6B7280; --text: #1F2937;
  --red: #DC2626; --red-bg: #FEF2F2; --red-bd: #FECACA;
  --grn: #059669; --grn-bg: #F0FDF4; --grn-bd: #BBF7D0;
  --blu-lt: #EFF6FF; --blu-bd: #BFDBFE;
}
body {
  font-family: 'Noto Sans KR', 'NanumSquare', 'Malgun Gothic', sans-serif;
  background: #e8eaf0;
  color: var(--text);
  min-height: 100vh;
}

/* â”€â”€ Top Nav â”€â”€ */
.topbar {
  background: linear-gradient(to right, var(--navy), #2D3258);
  padding: 0 32px;
  display: flex; align-items: center; justify-content: space-between;
  height: 56px; box-shadow: 0 2px 12px rgba(0,0,0,.25);
  position: sticky; top: 0; z-index: 100;
}
.topbar-logo { display: flex; align-items: center; gap: 12px; }
.topbar-logo img { height: 28px; }
.topbar-logo h1 { font-size: 16px; font-weight: 800; color: #fff; }
.topbar-logo span { font-size: 11px; color: #a0aec0; margin-left: 4px; }
.topbar-actions { display: flex; gap: 10px; }

/* â”€â”€ Preset Buttons â”€â”€ */
.preset-bar {
  background: #fff; border-bottom: 1px solid var(--mg);
  padding: 12px 32px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
}
.preset-bar span { font-size: 13px; color: var(--dg); font-weight: 600; }
.preset-btn {
  padding: 6px 16px; border-radius: 20px; border: 1.5px solid;
  cursor: pointer; font-size: 13px; font-weight: 700; transition: all .15s;
}
.preset-det { border-color: var(--red); color: var(--red); background: var(--red-bg); }
.preset-det:hover { background: var(--red); color: #fff; }
.preset-neg { border-color: var(--grn); color: var(--grn); background: var(--grn-bg); }
.preset-neg:hover { background: var(--grn); color: #fff; }
.preset-clr { border-color: var(--mg); color: var(--dg); background: #fff; }
.preset-clr:hover { background: var(--lg); }

/* â”€â”€ Layout â”€â”€ */
.main { max-width: 860px; margin: 0 auto; padding: 28px 20px 60px; }

/* â”€â”€ Card â”€â”€ */
.card {
  background: #fff; border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,.08);
  margin-bottom: 20px; overflow: hidden;
}
.card-hd {
  background: linear-gradient(to right, var(--navy), #2D3258);
  padding: 14px 20px; display: flex; align-items: center; gap: 10px;
}
.card-hd .badge {
  width: 26px; height: 26px; border-radius: 50%;
  background: rgba(255,255,255,.2); color: #fff;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 800; flex-shrink: 0;
}
.card-hd h2 { font-size: 14px; font-weight: 800; color: #fff; }
.card-hd p  { font-size: 11px; color: #a0aec0; margin-top: 1px; }
.card-body  { padding: 20px; }

/* â”€â”€ Form Grid â”€â”€ */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px 20px; }
.form-grid.g1 { grid-template-columns: 1fr; }
.form-grid.g3 { grid-template-columns: 1fr 1fr 1fr; }
.span2 { grid-column: span 2; }

.fld label {
  display: block; font-size: 12px; font-weight: 700;
  color: var(--dg); margin-bottom: 5px;
}
.fld label .req { color: var(--red); margin-left: 2px; }
.fld input, .fld select, .fld textarea {
  width: 100%; padding: 9px 12px; border: 1.5px solid var(--mg);
  border-radius: 7px; font-size: 13px; color: var(--text);
  background: #fff; transition: border-color .15s;
  font-family: inherit;
}
.fld input:focus, .fld select:focus {
  outline: none; border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(74,144,217,.12);
}
.fld .hint { font-size: 11px; color: var(--dg); margin-top: 4px; }
.fld input[type="number"] { -moz-appearance: textfield; }
.fld input[type="number"]::-webkit-inner-spin-button { opacity: 1; }

/* â”€â”€ Toggle (Detected / Not Detected) â”€â”€ */
.toggle-group { display: flex; gap: 0; border-radius: 8px; overflow: hidden; border: 1.5px solid var(--mg); }
.toggle-opt { flex: 1; }
.toggle-opt input { display: none; }
.toggle-opt label {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 11px; cursor: pointer; font-size: 13px; font-weight: 700;
  color: var(--dg); background: #fff; transition: all .18s;
}
.toggle-opt input:checked + label.det-lbl { background: var(--red); color: #fff; }
.toggle-opt input:checked + label.neg-lbl { background: var(--grn); color: #fff; }

/* Score slider */
.score-wrap { display: flex; align-items: center; gap: 12px; }
.score-wrap input[type="range"] { flex: 1; accent-color: var(--blue); }
.score-display {
  min-width: 52px; padding: 6px 10px; border-radius: 7px;
  background: var(--blu-lt); border: 1.5px solid var(--blu-bd);
  font-size: 16px; font-weight: 800; color: var(--navy); text-align: center;
}

/* â”€â”€ CSO section â”€â”€ */
.cso-block {
  display: grid; grid-template-columns: 3fr 2fr; gap: 10px 14px;
  align-items: end; margin-bottom: 10px;
}
.cso-block label { font-size: 12px; font-weight: 700; color: var(--dg); display: block; margin-bottom: 5px; }
.prob-wrap { display: flex; align-items: center; gap: 8px; }
.prob-wrap input[type="range"] { flex: 1; accent-color: var(--red); }
.prob-display {
  min-width: 44px; padding: 5px 8px; border-radius: 6px;
  background: var(--red-bg); border: 1px solid var(--red-bd);
  font-size: 13px; font-weight: 800; color: var(--red); text-align: center;
}

/* Rank badge */
.rank-hd {
  display: flex; align-items: center; gap: 8px;
  font-size: 12px; font-weight: 700; color: var(--dg); margin-bottom: 8px;
}
.rank-dot {
  width: 22px; height: 22px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 900; color: #fff;
}

/* â”€â”€ Divider â”€â”€ */
.divider { border: none; border-top: 1.5px solid var(--mg); margin: 16px 0; }

/* â”€â”€ Conditional sections â”€â”€ */
.cond-section { display: none; }
.cond-section.visible { display: block; }

/* â”€â”€ Submit â”€â”€ */
.submit-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: #fff; border-top: 1px solid var(--mg);
  padding: 14px 32px; display: flex; justify-content: flex-end;
  gap: 12px; box-shadow: 0 -4px 16px rgba(0,0,0,.08); z-index: 100;
}

/* â”€â”€ Buttons â”€â”€ */
.btn {
  padding: 11px 24px; border-radius: 8px; border: none; cursor: pointer;
  font-size: 14px; font-weight: 700; display: flex; align-items: center;
  gap: 8px; transition: all .18s;
}
.btn-primary { background: var(--navy); color: #fff; }
.btn-primary:hover { background: #262c54; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(27,31,59,.35); }
.btn-outline { background: #fff; color: var(--navy); border: 1.5px solid var(--mg); }
.btn-outline:hover { background: var(--lg); }

/* â”€â”€ Validation â”€â”€ */
.fld input.invalid, .fld select.invalid { border-color: var(--red); }
.fld .err-msg { font-size: 11px; color: var(--red); margin-top: 4px; display: none; }
.fld.has-error .err-msg { display: block; }

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 640px) {
  .form-grid { grid-template-columns: 1fr; }
  .form-grid.g3 { grid-template-columns: 1fr 1fr; }
  .span2 { grid-column: span 1; }
  .topbar { padding: 0 16px; }
  .main { padding: 16px 12px 80px; }
}
</style>
</head>
<body>

<!-- Top bar -->
<div class="topbar">
  <div class="topbar-logo">
    <img src="logo_new.png" alt="AiMA">
    <div>
      <h1>AiMA C12 <span>ê²°ê³¼ì§€ ìƒì„±</span></h1>
    </div>
  </div>
  <div class="topbar-actions">
    <button class="btn btn-outline" style="font-size:13px;padding:7px 14px"
      onclick="location.href='report.html'">ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸° â†’</button>
  </div>
</div>

<!-- Preset bar -->
<div class="preset-bar">
  <span>ìƒ˜í”Œ ë°ì´í„°:</span>
  <button class="preset-btn preset-det" onclick="loadPreset('det')">ğŸ”´ ì–‘ì„± ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <button class="preset-btn preset-neg" onclick="loadPreset('neg')">ğŸŸ¢ ìŒì„± ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <button class="preset-btn preset-clr" onclick="resetForm()">âœ• ì´ˆê¸°í™”</button>
</div>

<div class="main">
<form id="reportForm" novalidate>

<!-- â”€â”€ Â§1 í™˜ì ì •ë³´ â”€â”€ -->
<div class="card">
  <div class="card-hd">
    <div class="badge">1</div>
    <div><h2>í™˜ì ì •ë³´</h2><p>Patient Information</p></div>
  </div>
  <div class="card-body">
    <div class="form-grid">
      <div class="fld">
        <label>í™˜ì ID <span class="req">*</span></label>
        <input type="text" id="patientId" placeholder="ì˜ˆ: AiMA-2026-00472">
      </div>
      <div class="fld">
        <label>ì´ë¦„ <span class="req">*</span></label>
        <input type="text" id="patientName" placeholder="ì˜ˆ: í™ * ë™ (Hong **-dong)">
      </div>
      <div class="fld">
        <label>ìƒë…„ì›”ì¼ <span class="req">*</span></label>
        <input type="date" id="birthDate">
        <div class="hint">ë‚˜ì´ëŠ” ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
      </div>
      <div class="fld">
        <label>ì„±ë³„ <span class="req">*</span></label>
        <select id="gender">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="ë‚¨ì„± (Male)">ë‚¨ì„± (Male)</option>
          <option value="ì—¬ì„± (Female)">ì—¬ì„± (Female)</option>
        </select>
      </div>
      <div class="fld">
        <label>ì˜ë¢°ê¸°ê´€ <span class="req">*</span></label>
        <input type="text" id="institution" placeholder="ì˜ˆ: ì„œìš¸ëŒ€í•™êµë³‘ì›">
      </div>
      <div class="fld">
        <label>ì˜ë¢°ì˜ <span class="req">*</span></label>
        <input type="text" id="doctor" placeholder="ì˜ˆ: ê¹€ì˜ìˆ˜ (ì¢…ì–‘ë‚´ê³¼)">
      </div>
      <div class="fld">
        <label>ê²€ì²´ ì ‘ìˆ˜ì¼ <span class="req">*</span></label>
        <input type="date" id="collectionDate">
      </div>
      <div class="fld">
        <label>ë³´ê³ ì„œ ë°œí–‰ì¼ <span class="req">*</span></label>
        <input type="date" id="reportDate">
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Â§2 ê²€ì‚¬ ê²°ê³¼ â”€â”€ -->
<div class="card">
  <div class="card-hd">
    <div class="badge">2</div>
    <div><h2>ê²€ì‚¬ ê²°ê³¼</h2><p>Test Result</p></div>
  </div>
  <div class="card-body">
    <div class="fld" style="margin-bottom:16px">
      <label>ì•” ì‹ í˜¸ ê°ì§€ ì—¬ë¶€ <span class="req">*</span></label>
      <div class="toggle-group">
        <div class="toggle-opt">
          <input type="radio" name="detected" id="det-yes" value="true" onchange="onDetectedChange()">
          <label for="det-yes" class="det-lbl">ğŸ”´ ì•” ì‹ í˜¸ ê°ì§€ë¨ (Detected)</label>
        </div>
        <div class="toggle-opt">
          <input type="radio" name="detected" id="det-no" value="false" onchange="onDetectedChange()" checked>
          <label for="det-no" class="neg-lbl">ğŸŸ¢ ì•” ì‹ í˜¸ ë¯¸ê°ì§€ (Not Detected)</label>
        </div>
      </div>
    </div>

    <div class="form-grid g3">
      <div class="fld">
        <label>ì•” ì‹ í˜¸ ìŠ¤ì½”ì–´ <span class="req">*</span></label>
        <div class="score-wrap">
          <input type="range" id="scoreSlider" min="0" max="1" step="0.01" value="0.08"
            oninput="$('scoreVal').textContent=parseFloat(this.value).toFixed(2); $('scoreInput').value=this.value">
          <div class="score-display" id="scoreVal">0.08</div>
        </div>
        <input type="hidden" id="scoreInput" value="0.08">
      </div>
      <div class="fld">
        <label>95% CI í•˜í•œ</label>
        <input type="number" id="ciLow" min="0" max="1" step="0.01" placeholder="0.00">
      </div>
      <div class="fld">
        <label>95% CI ìƒí•œ</label>
        <input type="number" id="ciHigh" min="0" max="1" step="0.01" placeholder="0.00">
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Â§3 CSO Top 3 (Detected only) â”€â”€ -->
<div class="card cond-section" id="cso-section">
  <div class="card-hd">
    <div class="badge">3</div>
    <div><h2>ì•” ì‹ í˜¸ ê¸°ì› ë¶„ì„ â€” CSO Top 3</h2><p>Cancer Signal Origin</p></div>
  </div>
  <div class="card-body">
    <!-- CSO 1 -->
    <div class="rank-hd"><div class="rank-dot" style="background:#DC2626">1</div> 1ìˆœìœ„</div>
    <div class="cso-block">
      <div class="fld">
        <label>ê¸°ì› ì¥ê¸°</label>
        <select id="cso1-organ"><option value="">ì„ íƒ</option></select>
      </div>
      <div class="fld">
        <label>ì˜ˆì¸¡ í™•ë¥  (%)</label>
        <div class="prob-wrap">
          <input type="range" id="cso1-slider" min="0" max="100" step="1" value="72"
            oninput="$('cso1-disp').textContent=this.value+'%'; $('cso1-prob').value=this.value">
          <div class="prob-display" id="cso1-disp">72%</div>
        </div>
        <input type="hidden" id="cso1-prob" value="72">
      </div>
    </div>
    <hr class="divider">

    <!-- CSO 2 -->
    <div class="rank-hd"><div class="rank-dot" style="background:#F59E0B">2</div> 2ìˆœìœ„</div>
    <div class="cso-block">
      <div class="fld">
        <label>ê¸°ì› ì¥ê¸°</label>
        <select id="cso2-organ"><option value="">ì„ íƒ</option></select>
      </div>
      <div class="fld">
        <label>ì˜ˆì¸¡ í™•ë¥  (%)</label>
        <div class="prob-wrap">
          <input type="range" id="cso2-slider" min="0" max="100" step="1" value="16"
            oninput="$('cso2-disp').textContent=this.value+'%'; $('cso2-prob').value=this.value">
          <div class="prob-display" id="cso2-disp" style="background:#FFFBEB;border-color:#FDE68A;color:#D97706">16%</div>
        </div>
        <input type="hidden" id="cso2-prob" value="16">
      </div>
    </div>
    <hr class="divider">

    <!-- CSO 3 -->
    <div class="rank-hd"><div class="rank-dot" style="background:#8B5CF6">3</div> 3ìˆœìœ„</div>
    <div class="cso-block">
      <div class="fld">
        <label>ê¸°ì› ì¥ê¸°</label>
        <select id="cso3-organ"><option value="">ì„ íƒ</option></select>
      </div>
      <div class="fld">
        <label>ì˜ˆì¸¡ í™•ë¥  (%)</label>
        <div class="prob-wrap">
          <input type="range" id="cso3-slider" min="0" max="100" step="1" value="8"
            oninput="$('cso3-disp').textContent=this.value+'%'; $('cso3-prob').value=this.value">
          <div class="prob-display" id="cso3-disp" style="background:#F5F3FF;border-color:#DDD6FE;color:#7C3AED">8%</div>
        </div>
        <input type="hidden" id="cso3-prob" value="8">
      </div>
    </div>
    <p style="font-size:11px;color:var(--dg);margin-top:8px">â€» 3ê°œ í™•ë¥ ì˜ í•©ì´ 100%ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
  </div>
</div>

<!-- â”€â”€ Â§4 Fragmentomics â”€â”€ -->
<div class="card">
  <div class="card-hd">
    <div class="badge" id="frag-badge">4</div>
    <div><h2>Fragmentomics ë¶„ì„ê°’</h2><p>cfDNA Fragmentation Feature Values</p></div>
  </div>
  <div class="card-body">

    <!-- Detected: ìƒì„¸ 3íŒŒíŠ¸ -->
    <div class="cond-section" id="frag-det-section">
      <p style="font-size:12px;font-weight:700;color:var(--navy);margin-bottom:12px">â–¸ ë‹¨í¸ ê¸¸ì´ í”„ë¡œíŒŒì¼ (Fragment Size Profile)</p>
      <div class="form-grid">
        <div class="fld"><label>ì¤‘ê°„ ë‹¨í¸ ê¸¸ì´ (bp)</label>
          <input type="number" id="medianLen" step="1" placeholder="ì˜ˆ: 152">
          <div class="hint">ì°¸ì¡°: 160â€“170 bp</div></div>
        <div class="fld"><label>Short/Long ë¹„ìœ¨</label>
          <input type="number" id="slRatio" step="0.01" placeholder="ì˜ˆ: 0.38">
          <div class="hint">ì°¸ì¡°: 0.15â€“0.25</div></div>
        <div class="fld"><label>ë‹¨í¸ ê¸¸ì´ ì—”íŠ¸ë¡œí”¼</label>
          <input type="number" id="entropy" step="0.01" placeholder="ì˜ˆ: 3.82">
          <div class="hint">ì°¸ì¡°: 3.20â€“3.50</div></div>
        <div class="fld"><label>167bp í”¼í¬ ë¹„ìœ¨</label>
          <input type="number" id="peak167" step="0.01" placeholder="ì˜ˆ: 0.31">
          <div class="hint">ì°¸ì¡°: 0.42â€“0.55</div></div>
      </div>
      <hr class="divider">

      <p style="font-size:12px;font-weight:700;color:var(--navy);margin-bottom:12px">â–¸ ë‰´í´ë ˆì˜¤ì†œ í’‹í”„ë¦°íŠ¸ (Nucleosome Footprint)</p>
      <div class="form-grid">
        <div class="fld"><label>TSS ì»¤ë²„ë¦¬ì§€ ìŠ¤ì½”ì–´</label>
          <input type="number" id="tssCov" step="0.01" placeholder="ì˜ˆ: 0.72">
          <div class="hint">ì°¸ì¡°: 0.30â€“0.50</div></div>
        <div class="fld"><label>ì¡°ì§ íŠ¹ì´ì  ì‹ í˜¸ (Top 1)</label>
          <input type="text" id="tissueSignal" placeholder="ì˜ˆ: ëŒ€ì¥ (Colorectal)"></div>
        <div class="fld"><label>í”„ë¡œëª¨í„° ì ‘ê·¼ì„± ì§€ìˆ˜</label>
          <input type="number" id="promoterIdx" step="0.01" placeholder="ì˜ˆ: 2.31">
          <div class="hint">ì°¸ì¡°: 1.00â€“1.60</div></div>
      </div>
      <hr class="divider">

      <p style="font-size:12px;font-weight:700;color:var(--navy);margin-bottom:12px">â–¸ ë§ë‹¨ ì„œì—´ ëª¨í‹°í”„ (End Motif Pattern)</p>
      <div class="form-grid">
        <div class="fld"><label>4-mer ëª¨í‹°í”„ ë‹¤ì–‘ì„± (/ 256)</label>
          <input type="number" id="motifDiv" step="1" placeholder="ì˜ˆ: 218">
          <div class="hint">ì°¸ì¡°: 230â€“250</div></div>
        <div class="fld"><label>CCCA ëª¨í‹°í”„ ë¹ˆë„ (%)</label>
          <input type="number" id="cccaFreq" step="0.1" placeholder="ì˜ˆ: 4.8">
          <div class="hint">ì°¸ì¡°: 1.5â€“2.5%</div></div>
        <div class="fld"><label>ëª¨í‹°í”„ ë¶ˆê· í˜• ìŠ¤ì½”ì–´ (MDS)</label>
          <input type="number" id="mds" step="0.01" placeholder="ì˜ˆ: 0.68">
          <div class="hint">ì°¸ì¡°: 0.00â€“0.35</div></div>
      </div>
      <hr class="divider">

      <p style="font-size:12px;font-weight:700;color:var(--navy);margin-bottom:12px">â–¸ í”¼ì²˜ë³„ ê°œë³„ ìŠ¤ì½”ì–´ (0.00â€“1.00)</p>
      <div class="form-grid g3">
        <div class="fld"><label>ë‹¨í¸ ê¸¸ì´ í”„ë¡œíŒŒì¼ ìŠ¤ì½”ì–´</label>
          <input type="number" id="scoreSize" min="0" max="1" step="0.01" placeholder="ì˜ˆ: 0.82">
          <div class="hint">ê°€ì¤‘ì¹˜ 40%</div></div>
        <div class="fld"><label>ë‰´í´ë ˆì˜¤ì†œ í’‹í”„ë¦°íŠ¸ ìŠ¤ì½”ì–´</label>
          <input type="number" id="scoreNuc" min="0" max="1" step="0.01" placeholder="ì˜ˆ: 0.78">
          <div class="hint">ê°€ì¤‘ì¹˜ 35%</div></div>
        <div class="fld"><label>ë§ë‹¨ ì„œì—´ ëª¨í‹°í”„ ìŠ¤ì½”ì–´</label>
          <input type="number" id="scoreMotif" min="0" max="1" step="0.01" placeholder="ì˜ˆ: 0.91">
          <div class="hint">ê°€ì¤‘ì¹˜ 25%</div></div>
      </div>
      <div id="composite-preview" style="
        margin-top:12px;padding:12px 16px;border-radius:8px;
        background:var(--blu-lt);border:1px solid var(--blu-bd);
        display:flex;align-items:center;justify-content:space-between;
        font-size:13px;font-weight:700;color:var(--navy);">
        <span>ì¢…í•© ì•” ì‹ í˜¸ ìŠ¤ì½”ì–´ (ìë™ ê³„ì‚°)</span>
        <span id="composite-val" style="font-size:18px;color:var(--red)">â€”</span>
      </div>
    </div>

    <!-- Not Detected: ê¸°ë³¸ í”„ë¡œíŒŒì¼ -->
    <div class="cond-section visible" id="frag-neg-section">
      <p style="font-size:12px;color:var(--dg);margin-bottom:14px">
        ìŒì„± ê²°ê³¼ì˜ ê²½ìš° ê¸°ë³¸ ë‹¨í¸í™” í”„ë¡œíŒŒì¼ë§Œ ì…ë ¥í•©ë‹ˆë‹¤.</p>
      <div class="form-grid">
        <div class="fld"><label>cfDNA ë†ë„ (ng/mL)</label>
          <input type="number" id="cfDNAConc_neg" step="0.1" placeholder="ì˜ˆ: 7.2">
          <div class="hint">ì°¸ì¡°: 4â€“50 ng/mL</div></div>
        <div class="fld"><label>ì¤‘ê°„ ë‹¨í¸ ê¸¸ì´ (bp)</label>
          <input type="number" id="medianLen_neg" step="1" placeholder="ì˜ˆ: 167">
          <div class="hint">ì°¸ì¡°: 160â€“170 bp</div></div>
        <div class="fld"><label>Short/Long ë¹„ìœ¨</label>
          <input type="number" id="slRatio_neg" step="0.01" placeholder="ì˜ˆ: 0.19">
          <div class="hint">ì°¸ì¡°: 0.15â€“0.25</div></div>
        <div class="fld"><label>TSS ì»¤ë²„ë¦¬ì§€ ìŠ¤ì½”ì–´</label>
          <input type="number" id="tssCov_neg" step="0.01" placeholder="ì˜ˆ: 0.38">
          <div class="hint">ì°¸ì¡°: 0.30â€“0.50</div></div>
        <div class="fld"><label>ëª¨í‹°í”„ ë¶ˆê· í˜• ìŠ¤ì½”ì–´ (MDS)</label>
          <input type="number" id="mds_neg" step="0.01" placeholder="ì˜ˆ: 0.12">
          <div class="hint">ì°¸ì¡°: 0.00â€“0.35</div></div>
      </div>
    </div>

  </div>
</div>

<!-- â”€â”€ Â§5 QC â”€â”€ -->
<div class="card">
  <div class="card-hd">
    <div class="badge" id="qc-badge">5</div>
    <div><h2>ê²€ì²´ ë° ì‹œí€€ì‹± í’ˆì§ˆ ì§€í‘œ</h2><p>Quality Control Metrics</p></div>
  </div>
  <div class="card-body">
    <div class="form-grid">
      <div class="fld"><label>í˜ˆì¥ëŸ‰ (mL)</label>
        <input type="number" id="bloodVol" step="0.1" placeholder="ì˜ˆ: 4.2">
        <div class="hint">ì°¸ì¡°: â‰¥ 4.0 mL</div></div>
      <div class="fld"><label>cfDNA ë†ë„ (ng/mL)</label>
        <input type="number" id="cfDNAConc" step="0.1" placeholder="ì˜ˆ: 8.7">
        <div class="hint">ì°¸ì¡°: 4â€“50 ng/mL</div></div>
      <div class="fld"><label>ì‹œí€€ì‹± ê¹Šì´ WGS (Ã—)</label>
        <input type="number" id="seqDepth" step="0.1" placeholder="ì˜ˆ: 5.2">
        <div class="hint">ì°¸ì¡°: â‰¥ 3.0Ã—</div></div>
      <div class="fld"><label>Q30 ë¹„ìœ¨ (%)</label>
        <input type="number" id="q30" step="0.1" min="0" max="100" placeholder="ì˜ˆ: 96.3">
        <div class="hint">ì°¸ì¡°: â‰¥ 85%</div></div>
      <div class="fld"><label>ë§¤í•‘ë¥  (%)</label>
        <input type="number" id="mappingRate" step="0.1" min="0" max="100" placeholder="ì˜ˆ: 99.1">
        <div class="hint">ì°¸ì¡°: â‰¥ 95%</div></div>
      <div class="fld"><label>gDNA ì˜¤ì—¼ë„ (%)</label>
        <input type="number" id="gdnaContam" step="0.01" placeholder="ì˜ˆ: 0.1">
        <div class="hint">ì°¸ì¡°: &lt; 5%</div></div>
      <div class="fld"><label>ìœ íš¨ ë¦¬ë“œ ìˆ˜ (M)</label>
        <input type="number" id="effReads" step="1" placeholder="ì˜ˆ: 420">
        <div class="hint">ì°¸ì¡°: â‰¥ 200M</div></div>
    </div>
  </div>
</div>

<!-- â”€â”€ Â§6 ì„œëª… â”€â”€ -->
<div class="card">
  <div class="card-hd">
    <div class="badge" id="sig-badge">6</div>
    <div><h2>ì„œëª… ì •ë³´</h2><p>Signatures</p></div>
  </div>
  <div class="card-body">
    <div class="form-grid g3">
      <div class="fld"><label>ê²€ì‚¬ ë‹´ë‹¹ì</label>
        <input type="text" id="sigAnalyst" placeholder="ì˜ˆ: ê¹€ì§€ì› (MT)"></div>
      <div class="fld"><label>íŒë… ì „ë¬¸ì˜</label>
        <input type="text" id="sigReader" placeholder="ì˜ˆ: ë°•ì„±í›ˆ (MD, PhD)"></div>
      <div class="fld"><label>ë³´ê³ ì„œ ìŠ¹ì¸</label>
        <input type="text" id="sigApprover" placeholder="ì˜ˆ: ì´ì •ë¯¼ (MD)"></div>
    </div>
  </div>
</div>

</form><!-- /reportForm -->
</div><!-- /main -->

<!-- Submit bar -->
<div class="submit-bar">
  <button class="btn btn-outline" type="button" onclick="resetForm()">ì´ˆê¸°í™”</button>
  <button class="btn btn-primary" type="button" onclick="submitForm()">
    ë³´ê³ ì„œ ìƒì„± â†’
  </button>
</div>

<script>
/* â”€â”€ Shorthand â”€â”€ */
function $(id) { return document.getElementById(id); }
function val(id) { return ($(id) ? $(id).value.trim() : ''); }
function numVal(id) { return parseFloat(val(id)) || 0; }

/* â”€â”€ C12 Cancer list â”€â”€ */
const C12_OPTIONS = [
  'í (Lung)','ì·Œì¥ (Pancreatic)','ìœ„ (Gastric)','ì „ë¦½ì„  (Prostate)',
  'ìœ ë°© (Breast)','ë‹´ë„ê³„ (Biliary)','ëŒ€ì¥ (Colorectal)','ì‹ ì¥ (Renal)',
  'ì‹ë„ (Esophageal)','ìê¶ë‚´ë§‰ (Endometrial)','ë‚œì†Œ (Ovarian)','ê°„ (Liver)',
];

/* Populate CSO dropdowns */
['cso1-organ','cso2-organ','cso3-organ'].forEach(id => {
  const sel = $(id);
  C12_OPTIONS.forEach(opt => {
    const o = document.createElement('option');
    o.value = o.textContent = opt;
    sel.appendChild(o);
  });
});
$('cso1-organ').value = 'ëŒ€ì¥ (Colorectal)';
$('cso2-organ').value = 'ìœ„ (Gastric)';
$('cso3-organ').value = 'ì·Œì¥ (Pancreatic)';

/* Default dates */
const today = new Date().toISOString().slice(0,10);
$('reportDate').value = today;

/* â”€â”€ Detected / Not Detected toggle â”€â”€ */
function onDetectedChange() {
  const det = $('det-yes').checked;
  $('cso-section').classList.toggle('visible', det);
  $('frag-det-section').classList.toggle('visible', det);
  $('frag-neg-section').classList.toggle('visible', !det);
  // re-number badges
  $('frag-badge').textContent = det ? '4' : '4';
  $('qc-badge').textContent   = det ? '5' : '5';
  $('sig-badge').textContent  = det ? '6' : '6';
}

/* â”€â”€ Composite score live preview â”€â”€ */
function updateComposite() {
  const s = numVal('scoreSize'), n = numVal('scoreNuc'), m = numVal('scoreMotif');
  if (s && n && m) {
    const c = (s*0.40 + n*0.35 + m*0.25).toFixed(3);
    $('composite-val').textContent = c;
  }
}
['scoreSize','scoreNuc','scoreMotif'].forEach(id =>
  $(id) && $(id).addEventListener('input', updateComposite)
);

/* â”€â”€ Age auto-calc â”€â”€ */
$('birthDate').addEventListener('change', function() {
  // stored in data, no DOM display needed
});

/* â”€â”€ Presets â”€â”€ */
const PRESETS = {
  det: {
    patientId: 'AiMA-2026-00472', patientName: 'í™ * ë™ (Hong **-dong)',
    birthDate: '1968-03-15', gender: 'ë‚¨ì„± (Male)',
    institution: 'ì„œìš¸ëŒ€í•™êµë³‘ì›', doctor: 'ê¹€ì˜ìˆ˜ (ì¢…ì–‘ë‚´ê³¼)',
    collectionDate: '2026-02-10', reportDate: '2026-02-25',
    detected: true, score: 0.83, ciLow: 0.77, ciHigh: 0.89,
    cso1o: 'ëŒ€ì¥ (Colorectal)', cso1p: 72,
    cso2o: 'ìœ„ (Gastric)',      cso2p: 16,
    cso3o: 'ì·Œì¥ (Pancreatic)', cso3p: 8,
    medianLen:152, slRatio:0.38, entropy:3.82, peak167:0.31,
    tssCov:0.72, tissueSignal:'ëŒ€ì¥ (Colorectal)', promoterIdx:2.31,
    motifDiv:218, cccaFreq:4.8, mds:0.68,
    scoreSize:0.82, scoreNuc:0.78, scoreMotif:0.91,
    bloodVol:4.2, cfDNAConc:8.7, seqDepth:5.2, q30:96.3,
    mappingRate:99.1, gdnaContam:0.1, effReads:420,
    sigAnalyst:'ê¹€ì§€ì› (MT)', sigReader:'ë°•ì„±í›ˆ (MD, PhD)', sigApprover:'ì´ì •ë¯¼ (MD)',
  },
  neg: {
    patientId: 'AiMA-2026-00538', patientName: 'ê¹€ * í¬ (Kim **-hee)',
    birthDate: '1975-07-22', gender: 'ì—¬ì„± (Female)',
    institution: 'ì‚¼ì„±ì„œìš¸ë³‘ì›', doctor: 'ì´í˜„ì • (ê±´ê°•ì¦ì§„ì„¼í„°)',
    collectionDate: '2026-02-12', reportDate: '2026-02-25',
    detected: false, score: 0.08, ciLow: 0.03, ciHigh: 0.13,
    cso1o: '', cso1p: 0, cso2o: '', cso2p: 0, cso3o: '', cso3p: 0,
    cfDNAConc_neg:7.2, medianLen_neg:167, slRatio_neg:0.19, tssCov_neg:0.38, mds_neg:0.12,
    bloodVol:4.2, cfDNAConc:7.2, seqDepth:5.2, q30:96.3,
    mappingRate:99.1, gdnaContam:0.1, effReads:420,
    sigAnalyst:'ê¹€ì§€ì› (MT)', sigReader:'ë°•ì„±í›ˆ (MD, PhD)', sigApprover:'ì´ì •ë¯¼ (MD)',
  }
};

function loadPreset(type) {
  const p = PRESETS[type];
  $('patientId').value   = p.patientId;
  $('patientName').value = p.patientName;
  $('birthDate').value   = p.birthDate;
  $('gender').value      = p.gender;
  $('institution').value = p.institution;
  $('doctor').value      = p.doctor;
  $('collectionDate').value = p.collectionDate;
  $('reportDate').value  = p.reportDate;

  $('det-yes').checked = !!p.detected;
  $('det-no').checked  = !p.detected;
  onDetectedChange();

  const s = p.score;
  $('scoreSlider').value = s; $('scoreVal').textContent = s.toFixed(2); $('scoreInput').value = s;
  $('ciLow').value  = p.ciLow;
  $('ciHigh').value = p.ciHigh;

  if (p.detected) {
    $('cso1-organ').value = p.cso1o; $('cso1-slider').value = p.cso1p; $('cso1-disp').textContent = p.cso1p+'%'; $('cso1-prob').value = p.cso1p;
    $('cso2-organ').value = p.cso2o; $('cso2-slider').value = p.cso2p; $('cso2-disp').textContent = p.cso2p+'%'; $('cso2-prob').value = p.cso2p;
    $('cso3-organ').value = p.cso3o; $('cso3-slider').value = p.cso3p; $('cso3-disp').textContent = p.cso3p+'%'; $('cso3-prob').value = p.cso3p;
    $('medianLen').value=p.medianLen; $('slRatio').value=p.slRatio; $('entropy').value=p.entropy; $('peak167').value=p.peak167;
    $('tssCov').value=p.tssCov; $('tissueSignal').value=p.tissueSignal; $('promoterIdx').value=p.promoterIdx;
    $('motifDiv').value=p.motifDiv; $('cccaFreq').value=p.cccaFreq; $('mds').value=p.mds;
    $('scoreSize').value=p.scoreSize; $('scoreNuc').value=p.scoreNuc; $('scoreMotif').value=p.scoreMotif;
    updateComposite();
  } else {
    $('cfDNAConc_neg').value=p.cfDNAConc_neg; $('medianLen_neg').value=p.medianLen_neg;
    $('slRatio_neg').value=p.slRatio_neg;      $('tssCov_neg').value=p.tssCov_neg;
    $('mds_neg').value=p.mds_neg;
  }

  $('bloodVol').value=p.bloodVol;       $('cfDNAConc').value=p.cfDNAConc;
  $('seqDepth').value=p.seqDepth;       $('q30').value=p.q30;
  $('mappingRate').value=p.mappingRate; $('gdnaContam').value=p.gdnaContam;
  $('effReads').value=p.effReads;
  $('sigAnalyst').value=p.sigAnalyst;   $('sigReader').value=p.sigReader;
  $('sigApprover').value=p.sigApprover;
}

function resetForm() { $('reportForm').reset(); onDetectedChange(); $('composite-val').textContent='â€”'; }

/* â”€â”€ Age calc helper â”€â”€ */
function calcAge(dateStr) {
  if (!dateStr) return 0;
  const birth = new Date(dateStr);
  const now   = new Date();
  let age = now.getFullYear() - birth.getFullYear();
  const m = now.getMonth() - birth.getMonth();
  if (m < 0 || (m === 0 && now.getDate() < birth.getDate())) age--;
  return age;
}

/* â”€â”€ Submit â”€â”€ */
function submitForm() {
  // Required field check
  const required = ['patientId','patientName','birthDate','gender','institution','doctor','collectionDate','reportDate'];
  let valid = true;
  required.forEach(id => {
    if (!val(id)) { $(id).style.borderColor = 'var(--red)'; valid = false; }
    else            { $(id).style.borderColor = ''; }
  });
  if (!valid) { alert('í•„ìˆ˜ í•­ëª©(*)ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }

  const detected = $('det-yes').checked;
  const score    = parseFloat($('scoreInput').value) || 0;

  const data = {
    patientId:   val('patientId'),
    patientName: val('patientName'),
    birthDate:   val('birthDate').replace(/-/g, '.'),
    age:         calcAge(val('birthDate')),
    gender:      val('gender'),
    institution: val('institution'),
    doctor:      val('doctor'),
    collectionDate: val('collectionDate').replace(/-/g, '.'),
    reportDate:     val('reportDate').replace(/-/g, '.'),
    detected,
    score,
    ciLow:  parseFloat(val('ciLow'))  || 0,
    ciHigh: parseFloat(val('ciHigh')) || 0,
    reportId: `RPT-${val('reportDate').slice(0,4)}-C12-${val('patientId').slice(-5)}-${detected?'D':'N'}`,

    cso: detected ? [
      { organ: val('cso1-organ'), prob: parseInt($('cso1-prob').value)||0 },
      { organ: val('cso2-organ'), prob: parseInt($('cso2-prob').value)||0 },
      { organ: val('cso3-organ'), prob: parseInt($('cso3-prob').value)||0 },
    ].filter(c => c.organ) : [],

    frag: detected ? {
      medianLen:    numVal('medianLen'),    slRatio:   numVal('slRatio'),
      entropy:      numVal('entropy'),      peak167:   numVal('peak167'),
      tssCov:       numVal('tssCov'),       tissueSignal: val('tissueSignal'),
      promoterIdx:  numVal('promoterIdx'),  motifDiv:  numVal('motifDiv'),
      cccaFreq:     numVal('cccaFreq'),     mds:       numVal('mds'),
      scoreSize:    numVal('scoreSize'),    scoreNuc:  numVal('scoreNuc'),
      scoreMotif:   numVal('scoreMotif'),
    } : {
      cfDNAConc:  numVal('cfDNAConc_neg'), medianLen: numVal('medianLen_neg'),
      slRatio:    numVal('slRatio_neg'),   tssCov:    numVal('tssCov_neg'),
      mds:        numVal('mds_neg'),
    },

    qc: {
      bloodVol:    numVal('bloodVol'),   cfDNAConc:   numVal('cfDNAConc'),
      seqDepth:    numVal('seqDepth'),   q30:         numVal('q30'),
      mappingRate: numVal('mappingRate'),gdnaContam:  numVal('gdnaContam'),
      effReads:    numVal('effReads'),
    },

    sigs: {
      analyst:  val('sigAnalyst')  || 'â€”',
      reader:   val('sigReader')   || 'â€”',
      approver: val('sigApprover') || 'â€”',
    },
  };

  localStorage.setItem('aima_c12_report', JSON.stringify(data));
  window.open('report.html', '_blank');
}

/* Init */
onDetectedChange();
</script>
</body>
</html>
